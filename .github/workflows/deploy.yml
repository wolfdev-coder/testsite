name: Deploy Node.js App

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to Server via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: 83.166.246.183
          username: TheWolf1k
          key: -----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
        script: |
            cd /var/www/testsite
            git pull origin main
            # Установка з��висимостей в папке сервера
            cd server
            npm install --production

            # Исправляем права на случай, если что-то сбилось
            sudo chown -R TheWolf1k:TheWolf1k /var/www/testsite
            # Перезапуск PM2 (перезагрузит все или запустит, если упало)
            pm2 restart all || pm2 start server.js --name "my-app"
            pm2 save
